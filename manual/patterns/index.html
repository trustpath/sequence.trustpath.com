<!DOCTYPE HTML>

<html>
	<head>
		<title>Patterns: High Performance Log Analyzer and Parser</title>
		<meta http-equiv="content-type" content="text/html; charset=utf-8" />
		<meta name="description" content="Sequence is a high performance sequential log scanner, analyzer and parser. It sequentially goes through a log message, parses out the meaningful parts, without the use regular expressions. It can achieve high performance parsing of 100,000 - 200,000 messages per second (MPS) without the need to separate parsing rules by log source type." />
		<meta name="keywords" content="" />
		
		<script src="http://sequencer.io/js/jquery.min.js"></script>
		<script src="http://sequencer.io/js/skel.min.js"></script>
		<script src="http://sequencer.io/js/skel-layers.min.js"></script>
		<script src="http://sequencer.io/js/init.js"></script>
		
		<link rel="stylesheet" href="http://sequencer.io/css/skel.css" />
		<link rel="stylesheet" href="http://sequencer.io/css/style.css" />
		<link rel="stylesheet" href="http://sequencer.io/css/style-xlarge.css" />
		<link href="//netdna.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.css" rel="stylesheet">

		<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-681691-42', 'auto');
  ga('send', 'pageview');
   		</script>
	</head>
	
	<body id="top">
		
		<header id="header" class="skel-layers-fixed">
			<h1><a href="/">sequence</a></h1>
			<nav id="nav">
				<ul>
					
					<li><a href="/">Home</a></li>
					
					<li><a href="https://github.com/trustpath/sequence">Github</a></li>
					
					<li><a href="/manual/introduction/">Manual</a></li>
					
					<li><a href="/blog/">Blog</a></li>
					

					<li><a href="https://twitter.com/trustpath" class="icon fa-twitter"><span class="label">Twitter</span></a></li>
					<li><a href="https://linkedin.com/in/zhenjl" class="icon fa-linkedin"><span class="label">LinkedIn</span></a></li>
					</ul>
			</nav>
		</header>


		
			<section id="main" class="wrapper style1">
				<div class="container">
					<div class="row">

												<div class="3u">
							<section>
							
								<h3>Overview</h3>
								<ul class="alt">
								
									<li><a href="http://sequencer.io/manual/introduction/">Introduction</a></li>
								
									<li><a href="http://sequencer.io/manual/sequence/">Sequence</a></li>
								
									<li><a href="http://sequencer.io/manual/scanner/">Scanner</a></li>
								
									<li><a href="http://sequencer.io/manual/analyzer/">Analyzer</a></li>
								
									<li><a href="http://sequencer.io/manual/parser/">Parser</a></li>
								
								</ul>
							
								<h3>Sequence</h3>
								<ul class="alt">
								
									<li><a href="http://sequencer.io/manual/command/">Command</a></li>
								
									<li><a href="http://sequencer.io/manual/library/">Library</a></li>
								
									<li><a href="http://sequencer.io/manual/patterns/">Patterns</a></li>
								
								</ul>
							
								<h3>Configuration</h3>
								<ul class="alt">
								
									<li><a href="http://sequencer.io/manual/configuration/">Configuration</a></li>
								
									<li><a href="http://sequencer.io/manual/fields/">Predefined Fields</a></li>
								
									<li><a href="http://sequencer.io/manual/timeformats/">Time Formats</a></li>
								
									<li><a href="http://sequencer.io/manual/tokens/">Token Types</a></li>
								
								</ul>
							
							</section>
						</div>

						<div class="8u skel-cell-important">
							<section>
								<h2>Patterns</h2>

							    

<p><a href="#" class="image fit"><img src="/images/pic08.jpg" alt="" /></a></p>

<p>The <code>sequence</code> <em>parser</em> does not use regular expression. In fact, it won&rsquo;t understand any regular expression in the patterns even if you put them there. What it does recognize is a sequential pattern that follows the same format as the message it self. For fields that the analyst wants to extract, a field token of the form %fieldname% is put in its place.</p>

<p>As an example, this is pattern that&rsquo;s applied to the corresponding sudo message:</p>

<pre><code>jan 15 14:07:04 testserver sudo: pam_unix(sudo:auth): password failed

%msgtime% %apphost% %appname% : pam_unix ( sudo : %action% ) : %method% %status%
</code></pre>

<p>In this example, we are tagging six different tokens of the message with semantic fields, including:</p>

<table>
<thead>
<tr>
<th>Field</th>
<th>Value</th>
</tr>
</thead>

<tbody>
<tr>
<td>%msgtime%</td>
<td>jan 15 14:07:04</td>
</tr>

<tr>
<td>%apphost%</td>
<td>testserver</td>
</tr>

<tr>
<td>%appname%</td>
<td>sudo</td>
</tr>

<tr>
<td>%action%</td>
<td>auth</td>
</tr>

<tr>
<td>%method%</td>
<td>password</td>
</tr>

<tr>
<td>%status%</td>
<td>failed</td>
</tr>
</tbody>
</table>

<p>Note that it is not required to add spaces before and after the parenthesis. The parser uses the same scanner for message patters as it uses for the messages themselves, so the parenthesis will be extracted as separate tokens in both cases. It just seems to be more clear to have the spaces.</p>

<p>Here&rsquo;s another longer example (which you may have to horizontall scroll to see):</p>

<pre><code>id=firewall time=&quot;2005-03-18 14:01:46&quot; fw=TOPSEC priv=6 recorder=kernel type=conn policy=414 proto=TCP rule=accept src=61.167.71.244 sport=35223 dst=210.82.119.211 dport=25 duration=27 inpkt=37 outpkt=39 sent=1770 rcvd=20926 smac=00:04:c1:8b:d8:82 dmac=00:0b:5f:b2:1d:80

id = %appname% time = &quot; %msgtime% &quot; fw = %apphost% priv = %integer% recorder = %string% type = %string% policy = %policyid% proto = %protocol% rule = %status% src = %srcip% sport = %srcport% dst = %dstip% dport = %dstport% duration = %integer% inpkt = %pktsrecv% outpkt = %pktssent% sent = %bytessent% rcvd = %bytesrecv% smac = %srcmac% dmac = %dstmac%
</code></pre>

<h3 id="field-tokens:14e2d0f08075306ded7951a1dfc5e3e0">Field Tokens</h3>

<p>A field token is of the format &ldquo;%field:type:meta%&rdquo;:</p>

<ul>
<li>field is the name of the field</li>
<li>type is the token type of the field</li>
<li>meta is one of the following meta characters -, +, *, where

<ul>
<li>&rdquo;-&rdquo; means the rest of the tokens</li>
<li>&rdquo;+&rdquo; means one or more of this token</li>
<li>&ldquo;*&rdquo; means zero or more of this token</li>
</ul></li>
</ul>

<p>A field token can take different formats. The supported formats are:</p>

<ul>
<li>%field%</li>
<li>%type%</li>
<li>%field:type%</li>
<li>%field:meta%</li>
<li>%type:meta%</li>
<li>%field:type:meta%</li>
<li>%field:-:until%</li>
</ul>

<h4 id="using-the-meta-character:14e2d0f08075306ded7951a1dfc5e3e0">Using the <code>-</code> Meta Character</h4>

<p>Below is an example of how to use the <code>-</code> meta character:</p>

<pre><code>jan 14 10:15:56 testserver sudo:    gonner : tty=pts/3 ; pwd=/home/gonner ; user=root ; command=/bin/su - ustream

%msgtime% %apphost% %appname% : %srcuser% : tty = %string% ; pwd = %string% ; user = %dstuser% ; command = %method:-%
</code></pre>

<p>In this example, most field tokens are specified in the %field% format, except for the last one. The last token, <code>%method:-</code>, specifies that the <code>%method%</code> token should consume the rest of the tokens. This means the <code>%method%</code> token will have the value of <code>/bin/su - ustream</code>. This field token can also be specified as <code>%method::-</code>.</p>

<h4 id="using-the-meta-character-1:14e2d0f08075306ded7951a1dfc5e3e0">Using the <code>+</code> Meta Character</h4>

<p>Here&rsquo;s an example of using the <code>+</code> meta character:</p>

<pre><code>Feb  8 21:51:10 mail postfix/pipe[84059]: 440682230: to=&lt;userB@company.office&gt;, orig_to=&lt;userB@company.biz&gt;, relay=dovecot, delay=0.9, delays=0.87/0/0/0.03, dsn=2.0.0, status=sent (delivered via dovecot service)

%msgtime% %apphost% %appname% [ %sessionid% ] : %msgid:integer% : to = &lt; %srcemail% &gt; , orig_to = &lt; %string% &gt; , relay = %string% , delay = %float% , delays = %string% , dsn = %string% , status = %status% ( %reason::+% )
</code></pre>

<p>In this example, the 2nd to the last token is <code>%reason::+%</code>. This means the <code>%reason%</code> field token will consume one or more tokens until the close parenthesis. This can also be written as <code>%reason:+%</code>.</p>

<h4 id="using-the-meta-character-2:14e2d0f08075306ded7951a1dfc5e3e0">Using the <code>*</code> Meta Character</h4>

<p>Here&rsquo;s an example of using the <code>*</code> meta character:</p>

<pre><code>id=firewall time=&quot;2005-03-18 14:01:46&quot; fw=TOPSEC priv= recorder=kernel type=conn policy=414 proto=TCP rule=accept src=61.167.71.244 sport=35223 dst=210.82.119.211 dport=25 duration=27 inpkt=37 outpkt=39 sent=1770 rcvd=20926 smac=00:04:c1:8b:d8:82 dmac=00:0b:5f:b2:1d:80

id = %appname% time = &quot; %msgtime% &quot; fw = %apphost% priv = %integer:*% recorder = %string% type = %string% policy = %policyid% proto = %protocol% rule = %status% src = %srcip% sport = %srcport% dst = %dstip% dport = %dstport% duration = %integer% inpkt = %pktsrecv% outpkt = %pktssent% sent = %bytessent% rcvd = %bytesrecv% smac = %srcmac% dmac = %dstmac%
</code></pre>

<p>In this example, part of the pattern is specified as <code>priv = %integer:*%</code>. This means the value for <code>priv</code> may or may not be there. This can also be written as <code>%:integer:*%</code>.</p>

<h4 id="using-the-until-format:14e2d0f08075306ded7951a1dfc5e3e0">Using the &lsquo;until&rsquo; Format</h4>

<p>A common use case is to consume all tokens until a specific token is hit. As an example, below is an example of a message that has some JSON-like text in the middle:</p>

<pre><code>2015-01-24T19:34:47.269-0500 [conn72800] query foo.bar query: { _id: { $gte: { ContactId: BinData(3, 6C764EA2DABCE241C3E) }, $lt: { ContactId: BinData(3, 6C764EA2DAB4D9B1C3F) } } } planSummary: IXSCAN { _id: 1 } ntoreturn:0 ntoskip:0 nscanned:12 nscannedObjects:12 keyUpdates:0 numYields:10 locks(micros) r:2733 nreturned:12 reslen:4726 102ms
</code></pre>

<p>In this example, we want to extract anything after &ldquo;query:&rdquo; and before &ldquo;planSummary&rdquo; into the <em>object</em> field. To do that, we can write the following rule:</p>

<pre><code>%msgtime% [ %threadid% ] query %string% query : %object:-:plansummary% plansummary : %object::-%
</code></pre>

<p>Notice the token <code>%object:-:plansummary%</code>. What this says is that consume all the tokens from this point on, until the token <code>plansummary</code> is found. So the end result is <code>object</code> field will contain</p>

<pre><code>{ _id: { $gte: { ContactId: BinData(3, 6C764EA2DABCE241C3E) }, $lt: { ContactId: BinData(3, 6C764EA2DAB4D9B1C3F) } } }
</code></pre>

<p>After this token is done, the rest of the rule continues. Because this token does not consume the token <code>plansummary</code>, we start the rule again from that.</p>


							    <div style="text-align:center;margin-bottom:2em">
							    
							    &lt; <a href="http://sequencer.io/manual/library/">Library</a></li>
							    
							    &nbsp;
							    &nbsp;
							    &nbsp;
							    &nbsp;
							    &nbsp;
							    &nbsp;
							    &nbsp;
							    &nbsp;
							    &nbsp;
							    &nbsp;
							    &nbsp;
							    &nbsp;
							    &nbsp;
							    &nbsp;
							    &nbsp;
							    
							    <a href="http://sequencer.io/manual/configuration/">Configuration</a> &gt;</li>
							    
							    </div>

								<div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
    
    
    if (window.location.hostname == "localhost")
        return;

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'sequencer';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

							</section>
						</div>
					</div>
				</div>
			</section>

		
		<footer id="footer">
			<div class="container">
				<div class="row double">
					<div class="6u">
						<div class="row collapse-at-2">
							<div class="6u">
								<h3>Projects</h3>
								<ul class="alt">
									
									<li><a href="https://github.com/surgemq/surgemq">SurgeMQ</a></li>
									
									<li><a href="https://github.com/trustpath/sequence">Sequence</a></li>
									
									<li><a href="https://github.com/surge">Others Cool Projects</a></li>
									
								</ul>
							</div>
							<div class="6u">
								<h3>Sites</h3>
								<ul class="alt">
									
									<li><a href="http://surgemq.com">SurgeMQ Blog</a></li>
									
									<li><a href="http://zhen.org">Zen 3.1 Blog</a></li>
									
								</ul>
							</div>
						</div>
					</div>
					<div class="6u">
						<h2>Sequence</h2>
						<p>Sequence is a high performance sequential log scanner, analyzer and parser. It sequentially goes through a log message, parses out the meaningful parts, without the use regular expressions. It can parse over 100,000 messages per second without the need to separate parsing rules by log source type.</p>
						<ul class="icons">
							<li><a href="https://twitter.com/trustpath" class="icon fa-twitter"><span class="label">Twitter</span></a></li>
							<li><a href="https://linkedin.com/in/zhenjl" class="icon fa-linkedin"><span class="label">LinkedIn</span></a></li>
							<li><a href="https://github.com/trustpath/sequence" class="icon fa-github"><span class="label">Github</span></a></li>
						</ul>
					</div>
				</div>
				<ul class="copyright">
					<li>&copy; Dataence, LLC. All Rights Reserved.</li>
					<li>Built by <a href="http://gohugo.io">Hugo</a></li>
					<li>Design by <a href="http://templated.co">TEMPLATED</a></li>
					<li>Images by <a href="http://unsplash.com">Unsplash</a></li>
				</ul>
			</div>
		</footer>

	</body>
</html>
